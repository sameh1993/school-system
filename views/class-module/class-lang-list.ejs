<!DOCTYPE html>
<html lang="en">
<%- include("../parts/head") %>

<body dir="rtl">

    <!-- start side bar  -->
    <%- include("../parts/side-bar")%>
    <!--/.sidebar-->


    <!-- start main section -->
    <div style="float: left" class="dashboard mb-4 col-sm-9 col-lg-10 main">
        <h4 class="text-center text-capitalize main-title"> مدرسه <%= SchoolName %> </h4>
        <div class="row">
            <ol class="breadcrumb">
                <li><a href="#">
                        <em class="fa fa-home"></em>
                    </a></li>
                <li class="active"> الفصول </li>
            </ol>
        </div>
        <!--/.row-->

        <div class="querys">

            <h3 class="text-center"> قائمه الفصل <%= className %> </h3>

            <table class="table table-striped">
                <thead>
                    <tr>
                        <th scope="col"> الماده الدراسيه </th>
                        <th scope="col"> اسم المعلم </th>
                        <th scope="col">تعديل</th>
                    </tr>
                </thead>
                <tbody>
                    <% for(let lang of classLangs) {  %>
                    <tr class="parent">
                        <td> <%= lang.subj_name %> </td>
                        <input type="hidden" class="classId" value="<%= lang.class_id %>">
                        <input type="hidden" class="subjId" value="<%= lang.subject_id %>">
                        <td>
                            <select class="form-control teachId">
                                <% filterTeach = teachers.filter(item => item.teaching_subj == lang.subj_name) %>
                                <% for(let teacher of filterTeach) {  %>
                                <option selected="<% teacher.teach_id == lang.teach_id ? 'true' : 'false' %>"
                                    value="<%= teacher.teach_id %>">
                                    <%= teacher.teach_name + ' - ' + teacher.teaching_subj  %> </option>
                                <% } %>
                            </select>
                        </td>
                        <td> <button class="btn btn-primary edit" type="button"> edit </button> </td>
                    </tr>
                    <% } %>
                </tbody>
            </table>
        </div>


    </div>
    <!--/.main section-->


    <!-- start scripts for js files -->
    <script src="/js/jquery-1.11.1.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/axios/dist/axios.min.js"></script>
    <script>
        $(".edit").click(function () {
            const parent = $(this).parents(".parent")
            const data = {
                classId: parent.find('.classId').val(),
                subjId: parent.find(".subjId").val(),
                teachId: parent.find(".teachId").val()
            }
            axios.post("/class/change-teacher", data).then(result => {
                console.log(result)
            }).catch(err => {
               console.log(err) 
            })
        })
    </script>
</body>

</html>